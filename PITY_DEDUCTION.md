# 🎯 保底扣除机制说明（v1.5.0）

## 📊 核心改进

**问题**：因为有 100 抽保底必出神话的机制，所以部分神话物品是"保底"得到的，不是"运气"。

**解决**：计算评价时，扣除保底神话的价值，用数学期望填充。

---

## 🧮 计算逻辑

### 1. 数学期望值

根据当前爆率计算：
- **每抽期望值** = 16.87
- **100 抽期望值** = 16.87 × 100 = 1687

### 2. 保底神话

- **保底机制**：每 100 抽必出 1 个神话
- **神话价值**：600
- **问题**：这 600 价值是"机制"给的，不是"运气"

### 3. 修正算法

```
总价值 = 实际获得价值 
       - (保底神话数量 × 600)  // 扣除保底神话
       + (保底神话数量 × 1687)  // 用期望值填充
```

### 4. 举例说明

#### 例 1：100 抽，1 个神话（保底）

**原始算法：**
- 总价值 = 600（神话）+ 其他 ≈ 1650
- 欧气值 = 1650 / 60000 = 2.75%
- **评价**：普通人

**修正算法：**
- 保底神话数 = 1
- 总价值 = 1650 - 600 + 1687 = 2737
- 欧气值 = 2737 / 60000 = 4.56%
- **评价**：欧气满满

#### 例 2：100 抽，2 个神话（1 保底 + 1 运气）

**原始算法：**
- 总价值 = 1200（2 神话）+ 其他 ≈ 2200
- 欧气值 = 2200 / 60000 = 3.67%
- **评价**：小欧

**修正算法：**
- 保底神话数 = 1
- 总价值 = 2200 - 600 + 1687 = 3287
- 欧气值 = 3287 / 60000 = 5.48%
- **评价**：欧皇 ✨

#### 例 3：200 抽，2 个神话（全是保底）

**原始算法：**
- 总价值 = 1200（2 神话）+ 其他 ≈ 3300
- 欧气值 = 3300 / 120000 = 2.75%
- **评价**：普通人

**修正算法：**
- 保底神话数 = 2
- 总价值 = 3300 - 1200 + 3374 = 5474
- 欧气值 = 5474 / 120000 = 4.56%
- **评价**：欧气满满

#### 例 4：200 抽，5 个神话（2 保底 + 3 运气）

**原始算法：**
- 总价值 = 3000（5 神话）+ 其他 ≈ 5000
- 欧气值 = 5000 / 120000 = 4.17%
- **评价**：欧气满满

**修正算法：**
- 保底神话数 = 2
- 总价值 = 5000 - 1200 + 3374 = 7174
- 欧气值 = 7174 / 120000 = 5.98%
- **评价**：欧皇 ✨

---

## 📈 效果对比

### v1.4.0 vs v1.5.0

| 情况 | v1.4.0 评价 | v1.5.0 评价 | 说明 |
|------|-----------|-----------|------|
| 100 抽 1 神话（保底） | 普通人 | 欧气满满 | 保底不算运气 |
| 100 抽 2 神话 | 小欧 | 欧皇 | 多 1 个神话=真欧皇 |
| 200 抽 2 神话（全保底） | 普通人 | 欧气满满 | 全是保底，给平均评价 |
| 200 抽 5 神话 | 欧气满满 | 欧皇 | 3 个额外神话=真本事 |

---

## 🎯 设计理念

### 核心思想

**保底是"机制"，不是"运气"**

- 保底给的神话：用数学期望填充（1687/100 抽）
- 额外抽到的神话：算作真实运气（600/个）

### 评价标准

- **普通人**：全靠保底，没有额外运气
- **小欧/欧气满满**：有 1-2 个额外神话
- **欧皇**：有多个额外神话
- **超级大欧皇**：远超保底水平

---

## 🧪 验证方法

### 测试用例 1：纯保底

```
1. 输入兑换码：主任真帅 → 100 抽
2. 只抽到 1 个神话（保底）
3. 打开统计页面
4. 预期评价：欧气满满（不是普通人）
```

### 测试用例 2：额外神话

```
1. 输入兑换码：主任真帅 → 100 抽
2. 抽到 2 个神话（1 保底 + 1 运气）
3. 打开统计页面
4. 预期评价：欧皇（不是小欧）
```

### 测试用例 3：多次保底

```
1. 输入兑换码 2 次 → 200 抽
2. 抽到 2 个神话（全是保底）
3. 打开统计页面
4. 预期评价：欧气满满（不是普通人）
```

---

## ⚠️ 注意事项

1. **保底计数器**：每 100 抽重置一次
2. **神话统计**：Top 5 仍然显示所有神话
3. **总价值**：扣除保底后可能更高（因为期望值 > 保底价值）
4. **永久统计**：抽奖次数永久累积

---

## 📊 数学原理

### 为什么用期望值填充？

**问题**：如果直接扣除保底神话，总价值会偏低。

**解决**：用"如果这 100 抽正常抽，应该得到什么"来填充。

**计算**：
- 正常 100 抽的期望值 = 16.87 × 100 = 1687
- 保底神话价值 = 600
- **差值** = 1687 - 600 = 1087

这意味着：保底机制实际上"亏"了 1087 的价值，所以要补回来。

### 公平性

- **欧皇**：靠额外抽到的神话获得高评价
- **保底战士**：得到平均评价（期望值）
- **非酋**：连保底都没充分利用，得到低评价

---

祝你好运！🍀
